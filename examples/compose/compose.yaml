apiVersion: initrunner/v1
kind: Compose
metadata:
  name: email-pipeline
  description: Multi-agent email processing pipeline
spec:
  services:
    inbox-watcher:
      role: roles/inbox-watcher.yaml
      sink:
        type: delegate
        target: triager
    triager:
      role: roles/triager.yaml
      depends_on:
        - inbox-watcher
      sink:
        type: delegate
        target:
          - researcher
          - responder
        circuit_breaker_threshold: 5
    researcher:
      role: roles/researcher.yaml
      depends_on:
        - triager
    responder:
      role: roles/responder.yaml
      depends_on:
        - triager
      restart:
        condition: on-failure
        max_retries: 3
        delay_seconds: 5
